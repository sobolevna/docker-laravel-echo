version: '3'

services:
    php: 
        build: ./php
        container_name: php 
        ports: 
            - "80:80"
            - "443:443"
        depends_on: 
            - postgres 
            - redis 
        volumes: 
            - ./www:/var/www  
            - ./php/php.ini:/usr/local/etc/php/conf.d/z-custom.ini
            - ./php/openssl.cnf:/etc/ssl/openssl.cnf
            - ./apache2/sites-available/:/etc/apache2/sites-available/
            - ./apache2/ssl/:/etc/apache2/ssl/
            - ./apache2/logs/:/var/log/apache2/
            - ./apache2/apache2.conf:/etc/apache2/apache2.conf
    postgres: 
        container_name: postgres 
        image: postgres
        restart: always
        environment:
            POSTGRES_PASSWORD: root
        volumes: 
            - ./postgres/:/docker-entrypoint-initdb.d/
    redis:
        container_name: redis 
        image: redis
        restart: always 
        ports: 
            - 6379:6379 
    echo:
        container_name: echo 
        image: lagun4ik/laravel-echo-server 
        env_file: ./www/.env
        ports:
          - 6001:6001 
        depends_on: 
            - php 
            - redis
        links:
          - php 
          - redis
        volumes:
          - ./www/:/app/
          - ./apache2/ssl:/etc/apache2/ssl
